<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FIB Training Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root { color-scheme: dark; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0b0f; color:#fff; }

  .wrap { max-width: 1400px; margin: 0 auto; padding: 24px; }

  .toolbar {
    position: sticky; top: 0; z-index: 50;
    display:flex; flex-direction: column; gap:16px; margin-bottom:24px;
    padding: 10px 0 14px 0; background: #0b0b0f;
    border-bottom: 1px solid rgba(255,255,255,.08);
    transition: all 0.3s ease;
  }
  .toolbar.collapsed {
    padding: 8px 0;
  }
  .toolbar.collapsed .brand img {
    height: 48px;
  }
  .toolbar.collapsed h1 {
    font-size: 24px;
  }
  .collapse-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    background: rgba(0,0,0,.3);
    color: #fde047;
    border: 2px solid #fde047;
    border-radius: 8px;
    padding: 7px 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: background .15s, color .15s, border-color .15s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .collapse-btn:hover {
    background: rgba(253,224,71,.2);
    color: #fde047;
    border-color: #fde047;
  }
  .brand { display:flex; align-items:center; gap:12px; }
  .brand img { height: 128px; width:auto; border-radius:4px; }
  h1 { font-size:42px; font-weight:800; margin:0; letter-spacing:.02em; color: #fde047; font-family: 'Courier New', 'Monaco', 'Menlo', monospace; text-shadow: 0 0 10px rgba(253,224,71,.3); }

  /* Training Table Styles */
  .training-section {
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 24px;
  }

  .training-section h2 {
    margin: 0 0 16px;
    font-size: 18px;
    font-weight: 700;
    color: #fde047;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    text-shadow: 0 0 8px rgba(253,224,71,.2);
    border-bottom: 2px solid #fde047;
    padding-bottom: 8px;
  }

  .training-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(0,0,0,.3);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 20px;
  }

  .training-table th {
    background: #fde047;
    color: #000;
    padding: 12px 8px;
    font-weight: 700;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    text-align: left;
  }

  .training-table td {
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255,255,255,.1);
    font-size: 13px;
    color: #fff;
  }

  .training-table tr:hover {
    background: rgba(253,224,71,.1);
  }

  /* Form Styles */
  .add-trainee-form {
    background: rgba(0,0,0,.3);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .form-title {
    color: #fde047;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .form-row {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
  }

  .form-group {
    flex: 1;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #fff;
    font-size: 14px;
  }

  .form-group input {
    width: 100%;
    background: rgba(255,255,255,.05);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 8px;
    padding: 8px 12px;
    color: #fff;
    font-size: 14px;
  }

  .save-btn {
    background: #fde047;
    color: #000;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .save-btn:hover {
    background: #fff;
  }

  .checkbox-cell {
    text-align: center;
    padding: 8px 4px !important;
  }

  .checkbox-cell input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  .instructor-row td {
    text-align: center;
    font-size: 11px;
    color: #fde047;
    padding: 4px !important;
    border-bottom: 2px solid rgba(255,255,255,.1) !important;
  }

  .section-header td {
    background: rgba(253,224,71,.1);
    color: #fde047;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    padding: 8px !important;
    text-align: center;
  }

  .instructor-row:hover {
    background: none !important;
  }

  /* Roster Styles */
  .roster-section {
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 24px;
  }

  .roster-section h2 {
    margin: 0 0 16px;
    font-size: 18px;
    font-weight: 700;
    color: #fde047;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    text-shadow: 0 0 8px rgba(253,224,71,.2);
    border-bottom: 2px solid #fde047;
    padding-bottom: 8px;
  }

  .roster-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(0,0,0,.3);
    border-radius: 8px;
    overflow: hidden;
  }

  .roster-table th {
    background: #fde047;
    color: #000;
    padding: 12px 8px;
    font-weight: 700;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
  }

  .roster-table td {
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255,255,255,.1);
    font-size: 13px;
    color: #fff;
  }

  .roster-table tr:hover {
    background: rgba(253,224,71,.1);
  }

  .badge-cell {
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    font-weight: 700;
    color: #fde047;
    text-align: center;
    min-width: 80px;
  }

  .name-cell {
    font-weight: 600;
    color: #fff;
  }

  .rank-cell {
    font-weight: 500;
    color: #d1d5db;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.5px;
  }

  .discord-cell {
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    font-size: 11px;
    color: #9ca3af;
  }

  .add-trainee-btn {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.4);
    border-radius: 4px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.2s ease;
    margin-left: 8px;
  }

  .add-trainee-btn:hover {
    background: rgba(34, 197, 94, 0.3);
  }

  .name-cell-wrapper {
    display: flex;
    align-items: center;
  }

  .division-cell {
    font-weight: 500;
    color: #d1d5db;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.5px;
  }

  .status-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .status-badge.active {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.4);
  }

  .status-badge.inactive {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.4);
  }

  .roster-empty {
    text-align: center;
    color: rgba(255,255,255,.6);
    font-style: italic;
    padding: 20px;
  }

  .roster-loading {
    text-align: center;
    color: #fde047;
    padding: 20px;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    font-size: 14px;
    animation: pulse 1.5s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  /* Classified Entry Screen */
  .classified-entry {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #000000 50%, #0a0a0a 75%, #000000 100%);
    background-size: 400% 400%;
    animation: classifiedBg 8s ease-in-out infinite;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .classified-watermark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: auto;
    opacity: 0.15;
    z-index: 1;
    filter: drop-shadow(0 0 30px #00ff00);
    animation: watermarkPulse 3s ease-in-out infinite;
  }

  @keyframes watermarkPulse {
    0%, 100% { 
      opacity: 0.1;
      filter: drop-shadow(0 0 20px #00ff00);
      transform: translate(-50%, -50%) scale(1);
    }
    50% { 
      opacity: 0.2;
      filter: drop-shadow(0 0 40px #00ff00);
      transform: translate(-50%, -50%) scale(1.05);
    }
  }

  .password-dialog {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.95);
    border: 2px solid #00ff00;
    border-radius: 10px;
    padding: 20px;
    z-index: 10000;
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
    text-align: center;
    min-width: 300px;
  }

  .password-dialog-title {
    color: #00ff00;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
  }

  .password-input {
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid #00ff00;
    color: #00ff00;
    padding: 8px 12px;
    width: 100%;
    margin-bottom: 16px;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    outline: none;
  }

  .password-input::placeholder {
    color: rgba(0, 255, 0, 0.5);
  }

  .password-dialog-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .password-dialog-btn {
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid #00ff00;
    color: #00ff00;
    padding: 6px 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
  }

  .password-dialog-btn:hover {
    background: rgba(0, 255, 0, 0.2);
  }

  @keyframes classifiedBg {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .classified-content {
    text-align: center;
    max-width: 800px;
    padding: 40px;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #00ff00;
    border-radius: 10px;
    box-shadow: 
      0 0 30px rgba(0, 255, 0, 0.3),
      inset 0 0 30px rgba(0, 255, 0, 0.1);
    animation: classifiedGlow 2s ease-in-out infinite alternate;
    position: relative;
    z-index: 2;
  }

  @keyframes classifiedGlow {
    0% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.3), inset 0 0 30px rgba(0, 255, 0, 0.1); }
    100% { box-shadow: 0 0 50px rgba(0, 255, 0, 0.5), inset 0 0 50px rgba(0, 255, 0, 0.2); }
  }

  .classified-logo {
    font-size: 72px;
    font-weight: 900;
    color: #00ff00;
    text-shadow: 0 0 20px #00ff00;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    letter-spacing: 8px;
    margin-bottom: 20px;
    animation: logoPulse 1.5s ease-in-out infinite;
    position: relative;
    z-index: 2;
  }

  @keyframes logoPulse {
    0%, 100% { transform: scale(1); text-shadow: 0 0 20px #00ff00; }
    50% { transform: scale(1.05); text-shadow: 0 0 30px #00ff00, 0 0 40px #00ff00; }
  }

  .classified-title {
    font-size: 24px;
    font-weight: 700;
    color: #ffffff;
    letter-spacing: 3px;
    margin-bottom: 10px;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
  }

  .classified-subtitle {
    font-size: 16px;
    color: #00ff00;
    letter-spacing: 2px;
    margin-bottom: 40px;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
  }

  .access-sequence {
    text-align: left;
    font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
    font-size: 14px;
    line-height: 1.8;
  }

  .access-line {
    margin-bottom: 8px;
    opacity: 0;
    animation: fadeInLine 0.5s ease-in forwards;
  }

  .access-line:nth-child(1) { animation-delay: 0.5s; }
  .access-line:nth-child(2) { animation-delay: 1s; }
  .access-line:nth-child(3) { animation-delay: 1.5s; }
  .access-line:nth-child(4) { animation-delay: 2s; }
  .access-line:nth-child(5) { animation-delay: 3.5s; }
  .access-line:nth-child(6) { animation-delay: 4s; }
  .access-line:nth-child(7) { animation-delay: 4.5s; }

  @keyframes fadeInLine {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .prompt {
    color: #00ff00;
    font-weight: 600;
  }

  .password-display {
    color: #ff0000;
    font-weight: 700;
    letter-spacing: 2px;
  }

  .verification-status {
    color: #00ff00;
    font-weight: 700;
  }

  .access-status {
    color: #00ff00;
    font-weight: 700;
  }

  .welcome-message {
    color: #00ff00;
    font-weight: 700;
    font-size: 16px;
  }

  .delete-btn {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.4);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .delete-btn:hover {
    background: rgba(239, 68, 68, 0.3);
  }

  #mainContent {
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
</style>
</head>
<body>
  <!-- Password Dialog -->
  <div id="passwordDialog" class="password-dialog">
    <div class="password-dialog-title">Enter Access Password</div>
    <input type="password" id="passwordInput" class="password-input" placeholder="Password">
    <div class="password-dialog-buttons">
      <button class="password-dialog-btn" onclick="submitPassword()">Submit</button>
      <button class="password-dialog-btn" onclick="cancelPassword()">Cancel</button>
    </div>
  </div>

  <!-- CLASSIFIED ENTRY SCREEN -->
  <div id="classifiedEntry" class="classified-entry">
    <img src="https://kappa.lol/3qib3z" alt="FIB Logo" class="classified-watermark">
    <div class="classified-content">
      <div class="classified-logo">FIB</div>
      <div class="classified-title">FEDERAL INVESTIGATION BUREAU</div>
      <div class="classified-subtitle">TRAINING DATABASE ACCESS</div>
      
      <div class="access-sequence">
        <div class="access-line">
          <span class="prompt">> ACCESSING SECURE SERVER...</span>
        </div>
        <div class="access-line">
          <span class="prompt">> ENCRYPTION: AES-256</span>
        </div>
        <div class="access-line">
          <span class="prompt">> AUTHENTICATING USER...</span>
        </div>
        <div class="access-line">
          <span class="prompt">> PASSWORD: </span>
          <span id="passwordDisplay" class="password-display"></span>
        </div>
        <div class="access-line">
          <span class="prompt">> VERIFICATION: </span>
          <span id="verificationStatus" class="verification-status"></span>
        </div>
        <div class="access-line">
          <span class="prompt">> STATUS: </span>
          <span id="accessStatus" class="access-status"></span>
        </div>
        <div class="access-line">
          <span class="prompt">> WELCOME: </span>
          <span id="welcomeMessage" class="welcome-message"></span>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap" id="mainContent">
    <div id="top" class="toolbar">
      <button id="collapseBtn" class="collapse-btn" type="button">
        <span class="collapse-text">Collapse</span>
      </button>
      <div class="brand">
        <img src="https://kappa.lol/3qib3z" alt="FIB Logo" />
        <h1>FIB TRAINING TRACKER</h1>
      </div>
    </div>

    <div class="add-trainee-form">
      <div class="form-title">Add New Trainee</div>
      <div class="form-row">
        <div class="form-group">
          <label for="traineeName">Trainee Name</label>
          <input type="text" id="traineeName" placeholder="Enter trainee name">
        </div>
      </div>
      <button type="button" class="save-btn" onclick="addNewTrainee()">Add Trainee</button>
    </div>

    <div class="training-section">
      <h2>Training Progress</h2>
      <div class="table-container">
        <table class="training-table" id="trainingTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>10 Codes</th>
              <th>Case Laws</th>
              <th>Pursuit</th>
              <th>Hostage</th>
              <th>Traffic Stop</th>
              <th>Breaching</th>
              <th>Scene Control</th>
              <th>COMMS</th>
              <th>Use of Force</th>
              <th>Filing Charges</th>
              <th>Reports</th>
              <th>Gunfight</th>
            </tr>
          </thead>
          <tbody id="trainingTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <div class="training-section">
      <h2>Departmental Training</h2>
      <div class="table-container">
        <table class="training-table" id="departmentalTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Supernatural Division</th>
              <th>Analyst Division</th>
              <th>Investigator Division</th>
              <th>Field Agent Division</th>
            </tr>
          </thead>
          <tbody id="departmentalTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- AGENT ROSTER -->
    <div id="sec-roster" class="roster-section">
      <h2>AGENT ROSTER</h2>
      <div id="rosterContainer">
        <div class="roster-loading">Loading roster data...</div>
      </div>
    </div>
  </div>

  <script>
    // Password protection
    const CORRECT_PASSWORD = 'FIB2024'; // Change this to your desired password
    
    let passwordAttempts = 0;
    const maxAttempts = 3;

    function showPasswordDialog() {
      const dialog = document.getElementById('passwordDialog');
      const input = document.getElementById('passwordInput');
      dialog.style.display = 'block';
      input.value = '';
      input.focus();

      // Add enter key listener
      input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          submitPassword();
        }
      });
    }

    function hidePasswordDialog() {
      const dialog = document.getElementById('passwordDialog');
      dialog.style.display = 'none';
    }

    function submitPassword() {
      const password = document.getElementById('passwordInput').value;
      hidePasswordDialog();
      
      document.getElementById('passwordDisplay').textContent = '*'.repeat(password.length);
      
      if (password === CORRECT_PASSWORD) {
        document.getElementById('verificationStatus').textContent = 'SUCCESS';
        document.getElementById('accessStatus').textContent = 'ACCESS GRANTED';
        document.getElementById('welcomeMessage').textContent = 'ADMINISTRATOR';
        
        setTimeout(() => {
          const classifiedEntry = document.getElementById('classifiedEntry');
          const mainContent = document.getElementById('mainContent');
          
          classifiedEntry.style.opacity = '0';
          mainContent.style.display = 'block';
          
          setTimeout(() => {
            classifiedEntry.style.display = 'none';
            mainContent.style.opacity = '1';
          }, 500);
        }, 1500);
      } else {
        passwordAttempts++;
        document.getElementById('verificationStatus').textContent = 'FAILED';
        document.getElementById('accessStatus').textContent = 'ACCESS DENIED';
        document.getElementById('welcomeMessage').textContent = 'UNAUTHORIZED';
        
        if (passwordAttempts < maxAttempts) {
          setTimeout(showPasswordDialog, 1500);
        } else {
          alert('Maximum password attempts exceeded. Please refresh the page to try again.');
        }
      }
    }

    function cancelPassword() {
      hidePasswordDialog();
      document.getElementById('passwordDisplay').textContent = '****';
      document.getElementById('verificationStatus').textContent = 'CANCELLED';
      document.getElementById('accessStatus').textContent = 'ACCESS DENIED';
      document.getElementById('welcomeMessage').textContent = 'UNAUTHORIZED';
    }

    function runClassifiedSequence() {
      setTimeout(showPasswordDialog, 2000);
    }

    // Handle toolbar collapse/expand
    // Roster Integration
    let rosterData = [];
    let rosterUpdateInterval;

    async function fetchRosterData() {
      try {
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/18YPIHPxr5ki5JUFpvEEAxx0sCOKKdgrsGaeO_1rOOMU/export?format=csv&gid=1266358180';
        
        const response = await fetch(SHEET_URL, {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Accept': 'text/csv',
          }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvText = await response.text();
        const lines = csvText.split('\n').filter(line => line.trim() !== '');
        
        if (lines.length === 0) {
          throw new Error('No data found in CSV');
        }
        
        // Find the header row
        let headerRowIndex = 0;
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].toLowerCase();
          if (line.includes('badge') && line.includes('name') && line.includes('rank')) {
            headerRowIndex = i;
            break;
          }
        }
        
        const headers = lines[headerRowIndex].split(',').map(h => h.trim().replace(/"/g, ''));
        const dataLines = lines.slice(headerRowIndex + 1);
          
        rosterData = dataLines.map(line => {
          const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
          const row = {};
          headers.forEach((header, index) => {
            row[header.toLowerCase()] = values[index] || '';
          });
          return row;
        }).filter(row => {
          return Object.values(row).some(value => value && value.trim() !== '');
        });
          
        updateRosterDisplay();
          
      } catch (error) {
        console.error('Error fetching roster:', error);
        
        // Fallback data
        rosterData = [
          { name: 'John Doe', rank: 'Special Agent', status: 'Active', badge: '001', discord: 'johndoe#1234' },
          { name: 'Jane Smith', rank: 'Senior Agent', status: 'Active', badge: '002', discord: 'janesmith#5678' },
          { name: 'Mike Johnson', rank: 'Agent', status: 'Active', badge: '003', discord: 'mikejohnson#9012' }
        ];
        updateRosterDisplay();
      }
    }

    function updateRosterDisplay() {
      const rosterContainer = document.getElementById('rosterContainer');
      if (!rosterContainer) return;
      
      rosterContainer.innerHTML = '';
      
      if (rosterData.length === 0) {
        rosterContainer.innerHTML = '<div class="roster-empty">No roster data available</div>';
        return;
      }
      
      const cleanData = rosterData
        .filter(agent => {
          const name = agent.name || '';
          const rank = agent.rank || '';
          return name.trim() !== '' && name.trim() !== 'N/A' && rank.trim() !== '';
        })
        .map(agent => ({
          badge: agent['badge#'] || 'N/A',
          name: agent.name || 'Unknown Agent',
          rank: agent.rank || 'Agent',
          status: agent.status || 'Active',
          discord: agent['discord id'] || 'N/A',
          division: agent.division || '',
        }))
        .sort((a, b) => {
          const rankOrder = {
            'Director': 1,
            'Deputy Director': 2,
            'Special Agent': 3,
            'Agent': 4,
            'Recruit': 5,
            'Trainee': 6
          };
          const aOrder = rankOrder[a.rank] || 99;
          const bOrder = rankOrder[b.rank] || 99;
          if (aOrder !== bOrder) return aOrder - bOrder;
          return a.name.localeCompare(b.name);
        });
      
      const table = document.createElement('table');
      table.className = 'roster-table';
      
      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr>
          <th>Badge #</th>
          <th>Agent Name</th>
          <th>Division</th>
          <th>Rank</th>
          <th>Status</th>
          <th>Discord</th>
        </tr>
      `;
      table.appendChild(thead);
      
      const tbody = document.createElement('tbody');
      cleanData.forEach(agent => {
        const row = document.createElement('tr');
        
        const badgeTd = document.createElement('td');
        badgeTd.textContent = agent.badge;
        badgeTd.className = 'badge-cell';
        row.appendChild(badgeTd);
        
        const nameTd = document.createElement('td');
        nameTd.className = 'name-cell';
        
        const nameWrapper = document.createElement('div');
        nameWrapper.className = 'name-cell-wrapper';
        
        const nameText = document.createElement('span');
        nameText.textContent = agent.name;
        nameWrapper.appendChild(nameText);
        
        const addButton = document.createElement('button');
        addButton.className = 'add-trainee-btn';
        addButton.textContent = '+';
        addButton.title = 'Add as trainee';
        addButton.onclick = () => {
          const existingTrainee = trainees.find(t => t.name === agent.name);
          if (existingTrainee) {
            alert('This agent is already in the trainee list.');
            return;
          }
          
          const trainee = {
            name: agent.name,
            skills: {
              // Basic Skills
              '10Codes': { completed: false, instructor: '' },
              'CaseLaws': { completed: false, instructor: '' },
              'Pursuit': { completed: false, instructor: '' },
              'Hostage': { completed: false, instructor: '' },
              'TrafficStop': { completed: false, instructor: '' },
              'Breaching': { completed: false, instructor: '' },
              'SceneControl': { completed: false, instructor: '' },
              'COMMS': { completed: false, instructor: '' },
              'UseOfForce': { completed: false, instructor: '' },
              'FilingCharges': { completed: false, instructor: '' },
              'Reports': { completed: false, instructor: '' },
              'Gunfight': { completed: false, instructor: '' },
              
              // Departmental Training
              'Supernatural': { completed: false, instructor: '' },
              'Analyst': { completed: false, instructor: '' },
              'Investigator': { completed: false, instructor: '' },
              'FieldAgent': { completed: false, instructor: '' }
            }
          };
          
          trainees.push(trainee);
          saveTrainees();
          updateTrainingTable();
          alert(`Added ${agent.name} to trainees list.`);
        };
        nameWrapper.appendChild(addButton);
        
        nameTd.appendChild(nameWrapper);
        row.appendChild(nameTd);
        
        const divisionTd = document.createElement('td');
        divisionTd.textContent = agent.division;
        divisionTd.className = 'division-cell';
        row.appendChild(divisionTd);
        
        const rankTd = document.createElement('td');
        rankTd.textContent = agent.rank;
        rankTd.className = 'rank-cell';
        row.appendChild(rankTd);
        
        const statusTd = document.createElement('td');
        const statusClass = agent.status.toLowerCase().includes('active') ? 'active' : 'inactive';
        statusTd.innerHTML = `<span class="status-badge ${statusClass}">${agent.status}</span>`;
        row.appendChild(statusTd);
        
        const discordTd = document.createElement('td');
        discordTd.textContent = agent.discord;
        discordTd.className = 'discord-cell';
        row.appendChild(discordTd);
        
        tbody.appendChild(row);
      });
      
      table.appendChild(tbody);
      rosterContainer.appendChild(table);
    }

    function startRosterUpdates() {
      fetchRosterData();
      rosterUpdateInterval = setInterval(fetchRosterData, 5 * 60 * 1000);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const toolbar = document.getElementById('top');
      const collapseBtn = document.getElementById('collapseBtn');
      const collapseText = collapseBtn.querySelector('.collapse-text');
      
      collapseBtn.addEventListener('click', () => {
        toolbar.classList.toggle('collapsed');
        collapseText.textContent = toolbar.classList.contains('collapsed') ? 'Expand' : 'Collapse';
      });

      // Start the classified sequence
      runClassifiedSequence();

      // Load saved trainees
      loadTrainees();

      // Start roster updates
      startRosterUpdates();
    });

    // Training data management
    let trainees = [];

    function loadTrainees() {
      const savedTrainees = localStorage.getItem('trainees');
      if (savedTrainees) {
        trainees = JSON.parse(savedTrainees);
        updateTrainingTable();
        updateDepartmentalTable();
      }
    }

    function saveTrainees() {
      localStorage.setItem('trainees', JSON.stringify(trainees));
    }

    function addNewTrainee() {
      const nameInput = document.getElementById('traineeName');
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('Please enter a trainee name');
        return;
      }

      const trainee = {
        name: name,
        skills: {
          // Basic Skills
          '10Codes': { completed: false, instructor: '' },
          'CaseLaws': { completed: false, instructor: '' },
          'Pursuit': { completed: false, instructor: '' },
          'Hostage': { completed: false, instructor: '' },
          'TrafficStop': { completed: false, instructor: '' },
          'Breaching': { completed: false, instructor: '' },
          'SceneControl': { completed: false, instructor: '' },
          'COMMS': { completed: false, instructor: '' },
          'UseOfForce': { completed: false, instructor: '' },
          'FilingCharges': { completed: false, instructor: '' },
          'Reports': { completed: false, instructor: '' },
          'Gunfight': { completed: false, instructor: '' },
          
          // Departmental Training
          'Supernatural': { completed: false, instructor: '' },
          'Analyst': { completed: false, instructor: '' },
          'Investigator': { completed: false, instructor: '' },
          'FieldAgent': { completed: false, instructor: '' }
        }
      };

      trainees.push(trainee);
      saveTrainees();
      updateTrainingTable();
      nameInput.value = '';
    }

    function deleteTrainee(index) {
      if (confirm(`Are you sure you want to delete ${trainees[index].name}?`)) {
        trainees.splice(index, 1);
        saveTrainees();
        updateTrainingTable();
      }
    }

    function updateTrainingTable() {
      const tbody = document.getElementById('trainingTableBody');
      tbody.innerHTML = '';

      trainees.forEach((trainee, index) => {
        // Create two rows for each trainee
        const mainRow = document.createElement('tr');
        const instructorRow = document.createElement('tr');
        instructorRow.className = 'instructor-row';
        
        // Name cell spanning two rows
        const nameCell = document.createElement('td');
        const nameWrapper = document.createElement('div');
        nameWrapper.style.display = 'flex';
        nameWrapper.style.alignItems = 'center';
        nameWrapper.style.gap = '8px';
        
        const nameText = document.createElement('span');
        nameText.textContent = trainee.name;
        nameWrapper.appendChild(nameText);
        
        const deleteButton = document.createElement('button');
        deleteButton.className = 'delete-btn';
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = () => deleteTrainee(index);
        nameWrapper.appendChild(deleteButton);
        
        nameCell.appendChild(nameWrapper);
        nameCell.rowSpan = 2;
        mainRow.appendChild(nameCell);

        // Basic Skills
        const basicSkills = [
          '10Codes', 'CaseLaws', 'Pursuit', 'Hostage', 'TrafficStop', 
          'Breaching', 'SceneControl', 'COMMS', 'UseOfForce', 
          'FilingCharges', 'Reports', 'Gunfight'
        ];

        // Add basic skills checkboxes
        basicSkills.forEach(skill => {
          const data = trainee.skills[skill];
          const cell = document.createElement('td');
          cell.className = 'checkbox-cell';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = data.completed;
          checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
              const instructor = prompt('Enter instructor name:');
              if (instructor) {
                trainee.skills[skill].completed = true;
                trainee.skills[skill].instructor = instructor;
                saveTrainees();
                updateTrainingTable();
                updateDepartmentalTable();
              } else {
                e.target.checked = false;
              }
            } else {
              trainee.skills[skill].completed = false;
              trainee.skills[skill].instructor = '';
              saveTrainees();
              updateTrainingTable();
              updateDepartmentalTable();
            }
          });
          
          cell.appendChild(checkbox);
          mainRow.appendChild(cell);

          // Add instructor name to instructor row
          const instructorCell = document.createElement('td');
          instructorCell.className = 'instructor-name';
          if (data.completed && data.instructor) {
            instructorCell.textContent = data.instructor;
          } else {
            instructorCell.innerHTML = '&nbsp;';
          }
          instructorRow.appendChild(instructorCell);
        });

        tbody.appendChild(mainRow);
        tbody.appendChild(instructorRow);
      });
    }

    function updateDepartmentalTable() {
      const tbody = document.getElementById('departmentalTableBody');
      tbody.innerHTML = '';

      trainees.forEach((trainee, index) => {
        // Create two rows for each trainee
        const mainRow = document.createElement('tr');
        const instructorRow = document.createElement('tr');
        instructorRow.className = 'instructor-row';
        
        // Name cell spanning two rows
        const nameCell = document.createElement('td');
        nameCell.textContent = trainee.name;
        nameCell.rowSpan = 2;
        mainRow.appendChild(nameCell);

        // Departmental Skills
        const deptSkills = ['Supernatural', 'Analyst', 'Investigator', 'FieldAgent'];
        
        deptSkills.forEach(skill => {
          const data = trainee.skills[skill];
          const cell = document.createElement('td');
          cell.className = 'checkbox-cell';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = data.completed;
          checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
              const instructor = prompt('Enter instructor name:');
              if (instructor) {
                trainee.skills[skill].completed = true;
                trainee.skills[skill].instructor = instructor;
                saveTrainees();
                updateTrainingTable();
                updateDepartmentalTable();
              } else {
                e.target.checked = false;
              }
            } else {
              trainee.skills[skill].completed = false;
              trainee.skills[skill].instructor = '';
              saveTrainees();
              updateTrainingTable();
              updateDepartmentalTable();
            }
          });
          
          cell.appendChild(checkbox);
          mainRow.appendChild(cell);

          // Add instructor name to instructor row
          const instructorCell = document.createElement('td');
          instructorCell.className = 'instructor-name';
          if (data.completed && data.instructor) {
            instructorCell.textContent = data.instructor;
          } else {
            instructorCell.innerHTML = '&nbsp;';
          }
          instructorRow.appendChild(instructorCell);
        });

        tbody.appendChild(mainRow);
        tbody.appendChild(instructorRow);
      });
    }
  </script>
</body>
</html>
